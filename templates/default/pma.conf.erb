#
# Generated by Chef for <%= node[:fqdn] %> 
# Local modifications will be overwritten.
#
# phpMyAdmin - Web based MySQL browser written in php
# 
# Allows only localhost by default
#
# But allowing phpMyAdmin to anyone other than localhost should be considered
# dangerous unless properly secured by SSL

Alias /phpMyAdmin <%= node[:pma][:home] %>
Alias /phpmyadmin <%= node[:pma][:home] %>
Alias /pma <%= node[:pma][:home] %>

<Directory <%= node[:pma][:home] %>>
   <IfModule mod_authz_core.c>
     # Apache 2.4
     <RequireAny>
       Require ip 10.0
       Require ip 127.0.0.1 
       <% node[:pma][:allowed_addrs].each do |allowedip| -%> 
       Require ip <%= allowedip %>
       <% end -%>
       Require ip ::1
     </RequireAny>
   </IfModule>
   <IfModule !mod_authz_core.c>
     # Apache 2.2
     Order Deny,Allow
     Deny from All
     Allow from 10.0
     Allow from 127.0.0.1 
     <% node[:pma][:allowed_addrs].each do |allowedip| -%> 
     Allow from <%= allowedip %>
     <% end -%>
     Allow from ::1
   </IfModule>
</Directory>

<Directory <%= node[:pma][:home] %>/setup/>
   <IfModule mod_authz_core.c>
     # Apache 2.4
     <RequireAny>
       Require ip 10.0
       Require ip 127.0.0.1 
        <% node[:pma][:allowed_addrs].each do |allowedip| -%> 
       Require ip <%= allowedip %>
       <% end -%>
       Require ip ::1
     </RequireAny>
   </IfModule>
   <IfModule !mod_authz_core.c>
     # Apache 2.2
     Order Deny,Allow
     Deny from All
     Allow from 10.0
     Allow from 127.0.0.1 
     <% node[:pma][:allowed_addrs].each do |allowedip| -%> 
     Allow from <%= allowedip %>
     <% end -%>
     Allow from ::1
   </IfModule>
</Directory>

# These directories do not require access over HTTP - taken from the original
# phpMyAdmin upstream tarball
#
<Directory <%= node[:pma][:home] %>/libraries/>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory <%= node[:pma][:home] %>/setup/lib/>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory <%= node[:pma][:home] %>/setup/frames/>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

# This configuration prevents mod_security at phpMyAdmin directories from
# filtering SQL etc.  This may break your mod_security implementation.
#
#<IfModule mod_security.c>
#    <Directory <%= node[:pma][:home] %>>
#        SecRuleInheritance Off
#    </Directory>
#</IfModule>